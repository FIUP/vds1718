\newcommand{\exFour}
{$\wbS{b}{S}~\cong{}_{sos}~\wbS{b}{(\ifABC{b}{S}{\skipistr})} $}

\newcommand{\exFourIff}
{$\confSs{\wbS{b}{S}}{s}\Rar{*}s'~\iff{}~\confSs{\wbS{b}
{(\ifABC{b}{S}{\skipistr})}}{s}\Rar{*}s'$}

\newcommand{\exFourLtR}
{$\confSs{\wbS{b}{S}}{s}\Rar{*}s'~\Rar{}~\confSs{\wbS{b}
{(\ifABC{b}{S}{\skipistr})}}{s}\Rar{*}s'$}

\exercise{Esercizio 4}
{
	Prove or disprove the following semantic equivalence:\\
	\begin{center}
	\exFour{}
	\end{center}
	where $b\in\bexp$ and $S\in\stm$
}
{
	Per dimostrare:
	\begin{center}
	\exFour{}
	\end{center}
	posso dimostrare che:
	\begin{center}
	\exFourIff{}
	\end{center}
	dimostrando separatamente i due versi dell'implicazione. \\
	
	\textbf{Implicazione \Rar{}} \\
	Per dimostrare che :
	\begin{center}
	se \exFourLtR{}
	\end{center}
	posso utilizzare l'induzione sul numero di passi che la derivazione di 
	\confSs{\wbS{b}{S}}{s} impiega per arrivare ad una configurazione finale 
	(supponendo, per ipotesi, che a partire dallo stato $s,~\wbS{b}{S}$
	termini).\\
	
	\casobase{n=0} Questo caso è banalmente vero poichè 
	\confSs{\wbS{b}{S}}{s} non è una configurazine finale ed in 0 passi quindi
	non può evolvere in una configurazione finale. Lo stesso ragionamento si
	può applicare nel caso in cui \textbf{n=1} e \textbf{n=2} poichè,
	sfruttando l'unfolding, sono neccessari almeno 3 passi per arrivare ad una
	configurazione finale.\\
	
	\casobase{n=3} In questo caso \wbS{b}{S} può arrivare ad uno stato finale
	in 3 passi solamente nel caso in cui $\mathbb{B}[b]_s=ff$ poichè
	\footnote{Infatti nel caso $\mathbb{B}[b]_s=tt$ avremo dei passi in più 
	dovuti (i) a $S$ che nel migliore dei casi è \skipistr{} e (ii) alla
	ricorsività del comando \texttt{while}}
	\begin{center}
	$\confSs{\wbS{b}{S}}{s}\Rar{}
	\confSs{
		\ifABC{b}
			{(\concat{S}{\wbS{b}{S}})}
			{\skipistr}
	}{s}\Rar{}
	\confSs{\skipistr}{s}\Rar{}s$
	\end{center}
	Quindi nel caso in cui \confSs{\wbS{b}{S}}{s} evolva in tre passi in una
	configurazione finale a destra avremo:
	\begin{center}
	$\confSs{\wbS{b}{(\ifABC{b}{S}{\skipistr})}}{s}\Rar{}$\\
	$\confSs{
		\ifABC{b}
		{(\concat{(\ifABC{b}{S}{\skipistr})}
		{\wbS{b}{(\ifABC{b}{S}{\skipistr})}})}
		{\skipistr}
	}{s}$
	\end{center}
	Dall'ipotesi sappiamo che $\mathbb{B}[b]_s=ff$ quindi:
	\begin{center}
	$\confSs{
		\ifABC{b}
		{(\concat{(\ifABC{b}{S}{\skipistr})}
		{\wbS{b}{(\ifABC{b}{S}{\skipistr})}})}
		{\skipistr}
	}{s}\Rar{}$ \\
	$\confSs{\skipistr}{s}\Rar{}{s}$
	\end{center}
	E quindi entrambi i programmi evolvono nello stesso stato finale.\\

	\casoinduttivo{n>3} In questo caso sappiamo che $\mathbb{B}[b]_s=tt$
	\footnote{altrimenti torneremo nel caso n=3}, quindi:
	\begin{center}
	$\confSs{\wbS{b}{S}}{s}\Rar{}$\\
	$\confSs{
		\ifABC{b}
			{(\concat{S}{\wbS{b}{S}})}
			{\skipistr}
	}{s}\Rar{}$\\
	$\confSs{\concat{S}{\wbS{b}{S}}}{s}\Rar{n-2}s'$
	\end{center}
	Per il \textbf{lemma di decomposizione} sappiamo che 
	$\exists{}~k_0,~k_1\in\mathbb{N},~s''\in\states~tali~che~n-2=k_0+k_1~e~
	\confSs{S}{s}\Rar{k_0}s''~e~\confSs{\wbS{b}{S}}{s''}\Rar{k_1}s'$ dal
	momento che per ipotesi sappiamo $\confSs{\wbS{b}{S}}{s}\Rar{*}s'$\\
	Quindi a destra troviamo:
	\begin{center}
	$\confSs{\wbS{b}{(\ifABC{b}{S}{\skipistr})}}{s}\Rar{}$\\
	$\confSs{
		\ifABC{b}
		{(\concat{(\ifABC{b}{S}{\skipistr})}
		{\wbS{b}{(\ifABC{b}{S}{\skipistr})}})}
		{\skipistr}}{s}\Rar{}$\\
	$\confSs{
		{(\concat{(\ifABC{b}{S}{\skipistr})}
		{\wbS{b}{(\ifABC{b}{S}{\skipistr})}})}
	}{s}$
	\end{center}
	poichè dall'ipotesi so che $\mathbb{B}[b]_s=tt$. Dal momento che 
	$\confSs{\ifABC{b}{S}{\skipistr}}{s}\Rar{}\confSs{S}{s}$ poichè
	$\mathbb{B}[b]_s=tt$ e dall'ipotesi so che $\confSs{S}{s}\Rar{k_0}s''$
	allora per il \textbf{lemma di composizione} so che:
	\begin{center}
	$\confSs{
		{(\concat{(\ifABC{b}{S}{\skipistr})}
		{\wbS{b}{(\ifABC{b}{S}{\skipistr})}})}
	}{s}\Rar{k_0+1}$\\
	$\confSs{\wbS{b}{(\ifABC{b}{S}{\skipistr})}}{s''}$
	\end{center}
	Inoltre poichè $k_1<n~(k_1=n-2-k_0)$ e $\confSs{\wbS{b}{S}}{s''}\Rar{k_1}s'$
	allora posso applicare l'\textbf{ipotesi induttiva} ed ottengo che
	$\confSs{\wbS{b}{(\ifABC{b}{S}{\skipistr})}}{s''}\Rar{*}s'$

}
